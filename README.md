# ChatworkReminderBot
チャットワークで定期発言botを設定するためのスクリプト

# 概要
Slackのreminderに相当するものをChatworkで実現するためのもの。
初期設定を済ませれば、非エンジニアでも以下のことができる。
- 日時を指定して、1回だけ発言する
- 曜日と時間を指定して、発言を繰り返す
  - 祝日には発言しないようにもできる
- 発言者を選択できる
- 発言する部屋を選択できる

# 設定手順

## 1. 発言設定用スプレッドシート
https://docs.google.com/spreadsheets/d/11Mq3wPyn42JubZFGF0HHLnLfwGKeWESHMZf5mYYij-Q/edit#gid=0
![設定用シート](https://user-images.githubusercontent.com/43110758/88803091-ec939680-d1e6-11ea-87e6-6dd29b6fc194.png)
このレイアウトをそのままコピーする。
- 注釈：スクリプトはこのレイアウトに合わせて動作する。
- 列の説明は、各列の1行目を参照。

## 2. 管理用スプレッドシート
1. 新たなスプレッドシートを作成する。
1. 2つのシート「TOKEN」と「HOLIDAY」を作成する。
    1. シート「TOKEN」には、発言者名とAPIトークンの関連を入力する。
        1. ![TOKENシートイメージ](https://user-images.githubusercontent.com/43110758/88771869-cf48d300-d1ba-11ea-83e8-c2aae568e16a.png)
        1. 発言設定用スプレッドシートの「発言者」欄は、ここで設定したもののみが使用可能。
    1. シート「HOLIDAY」には、祝日を入力する。
        1. ![HOLIDAYシートイメージ](https://user-images.githubusercontent.com/43110758/88771875-d374f080-d1ba-11ea-812c-d103c4e134d0.png)
1. このスプレッドシートにプロジェクトを作成する
1. プロジェクトに、当リポジトリのソースを全て移植する
1. config.gs の項目 SETTING_BOOK_ID と SETTING_SHEET_NAME を、発言設定用スプレッドシートに合わせて変更する
1. プロジェクトのライブラリに、以下を追加する
    1. https://github.com/cw-shibuya/chatwork-client-gas

## 3. 実行スケジュール
以下の通り、実行スケジュールを設定する。
1. main.gs -> clearFlag()
    1. 1日1回、0時～1時の間
1. main.gs -> startExecBot()
    1. 毎分

# 制限事項
1. 日付変更前後～1時までの間の動作は未検証
    1. 理由は、シート上に送信済みフラグを置くことで重複送信を防ぎ、0時～1時の間にそれをクリアするため
1. 1発言者につき、30件まで。
    1. チャットワークのAPI利用回数は5分あたり300回まで。
    1. 本スクリプトは毎分動作し、1発言につき、1回または2回APIを使用する。
        1. 「発言可否の調査」と「発言」の2回。
    1. よって、30件を超えると、API利用回数に抵触する可能性がある。

# 検討中の事項
1. 発言設定数30個の制限に関して
    1. 発言可否調査を発言時のエラーハンドルで代替すれば、倍にはできる。
    1. 動作頻度を下げれば、さらに増やせる。ただし発言タイミングの精度が落ちる。
1. 稼働時間帯の設定
    1. 現状は、24時間毎分APIを打ち続けることになる。
    1. 業務時間外は何もせず動作終了するようにすれば、余計な動作は減る。どさくさで日付変更～1時までの懸念ももみ消せる。
1. 発言可否調査について
    1. 時間設定的に発言する必要がない場合であっても、発言可否調査でAPIの枠を使っている。いけてない。
